RewriteEngine On

# =======================================================
# 1. REGRAS DE ROTEAMENTO (Para o site funcionar)
# =======================================================

# Se acessar a raiz, vai para public/index.php
RewriteRule ^$ public/index.php [L]

# Se o arquivo não existe na raiz, procura na public
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d
RewriteCond %{REQUEST_URI} !^/public/
RewriteRule ^(.*)$ public/$1 [L]

# =======================================================
# 2. SEGURANÇA (Para evitar invasões)
# =======================================================

# Impede listagem de pastas (Ninguém vê seus arquivos listados)
Options -Indexes

# Bloqueia acesso a arquivos sensíveis (Senhas, Git, Composer)
<FilesMatch "^\.|\.env|config\.env|composer\.lock|package\.json|\.git">
    Order allow,deny
    Deny from all
</FilesMatch>

# Bloqueia scripts maliciosos comuns
RewriteCond %{QUERY_STRING} base64_encode[^(]*\([^)]*\) [OR]
RewriteCond %{QUERY_STRING} (<|%3C)([^s]*s)+cript.*(>|%3E) [NC,OR]
RewriteCond %{QUERY_STRING} GLOBALS(=|\[|\%[0-9A-Z]{0,2}) [OR]
RewriteCond %{QUERY_STRING} _REQUEST(=|\[|\%[0-9A-Z]{0,2})
RewriteRule .* - [F]

# =======================================================
# 3. PERFORMANCE E CACHE (Para não estourar o limite grátis)
# =======================================================

# Ativa compressão Gzip (Diminui o tamanho dos arquivos enviados)
<IfModule mod_deflate.c>
    AddOutputFilterByType DEFLATE text/plain
    AddOutputFilterByType DEFLATE text/html
    AddOutputFilterByType DEFLATE text/xml
    AddOutputFilterByType DEFLATE text/css
    AddOutputFilterByType DEFLATE application/xml
    AddOutputFilterByType DEFLATE application/xhtml+xml
    AddOutputFilterByType DEFLATE application/rss+xml
    AddOutputFilterByType DEFLATE application/javascript
    AddOutputFilterByType DEFLATE application/x-javascript
</IfModule>

# Cache de Navegador (O cliente baixa a imagem 1 vez e guarda)
<IfModule mod_expires.c>
    ExpiresActive On
    ExpiresByType image/jpg "access plus 1 month"
    ExpiresByType image/jpeg "access plus 1 month"
    ExpiresByType image/gif "access plus 1 month"
    ExpiresByType image/png "access plus 1 month"
    ExpiresByType image/webp "access plus 1 month"
    ExpiresByType text/css "access plus 1 week"
    ExpiresByType application/javascript "access plus 1 week"
    ExpiresByType image/x-icon "access plus 1 year"
</IfModule>